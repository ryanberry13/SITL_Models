<?xml version='1.0'?>
<sdf version='1.6'>
<model name='steer_bot'>

  <link name='base_link'>
    <inertial>
      <pose>0 0 0 0 0 0</pose>
      <mass>5</mass>
      <inertia>
        <ixx>0.0416667</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>0.108333</iyy>
        <iyz>0</iyz>
        <izz>0.141667</izz>
      </inertia>
    </inertial>
    <collision name='collision'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <box>
          <size>0.5 0.3 0.1</size>
        </box>
      </geometry>
    </collision>
    <visual name='visual'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <box>
          <size>0.5 0.3 0.1</size>
        </box>
      </geometry>
      <material>
        <ambient>0 1 0</ambient>
        <diffuse>0 1 0</diffuse>
        <specular>0.1 0.1 0.1 1</specular>
      </material>
    </visual>
  </link>

  <joint name='front_left_steer_joint' type='revolute'>
    <pose relative_to='base_link'>0.2 0.2 0.12 0 0 0</pose>
    <parent>base_link</parent>
    <child>front_left_steer_link</child>
    <axis>
      <xyz>0 0 1</xyz>
      <limit>
        <lower>-3.14159</lower>
        <upper>3.14159</upper>
        <effort>10</effort>
        <velocity>5</velocity>
      </limit>
      <dynamics>
        <damping>0.0001</damping>
      </dynamics>
    </axis>
  </joint>
  <link name='front_left_steer_link'>
    <pose relative_to='front_left_steer_joint'>0 0 0 0 0 0</pose>
    <inertial>
      <pose>0 0 0 0 0 0</pose>
      <mass>1</mass>
      <inertia>
        <ixx>0.000658333</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>0.000658333</iyy>
        <iyz>0</iyz>
        <izz>0.00125</izz>
      </inertia>
    </inertial>
    <collision name='collision'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.02</length>
          <radius>0.05</radius>
        </cylinder>
      </geometry>
    </collision>
    <visual name='visual'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.02</length>
          <radius>0.05</radius>
        </cylinder>
      </geometry>
      <material>
        <ambient>0 0 1</ambient>
        <diffuse>0 0 1</diffuse>
        <specular>0.1 0.1 0.1 1</specular>
      </material>
    </visual>
  </link>

  <joint name='front_left_wheel_joint' type='revolute'>
    <pose relative_to='front_left_steer_link'>0 0 -0.12 -1.5708 0 0</pose>
    <parent>front_left_steer_link</parent>
    <child>front_left_wheel_link</child>
    <axis>
      <xyz>0 0 1</xyz>
      <limit>
        <lower>-1e+16</lower>
        <upper>1e+16</upper>
      </limit>
      <dynamics>
        <damping>0.0001</damping>
      </dynamics>
    </axis>
  </joint>
  <link name='front_left_wheel_link'>
    <pose relative_to='front_left_wheel_joint'>0 0 0 0 0 0</pose>
    <inertial>
      <pose>0 0 0 0 0 0</pose>
      <mass>1</mass>
      <inertia>
        <ixx>0.00303333</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>0.00303333</iyy>
        <iyz>0</iyz>
        <izz>0.005</izz>
      </inertia>
    </inertial>
    <collision name='collision'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.08</length>
          <radius>0.1</radius>
        </cylinder>
      </geometry>
    </collision>
    <visual name='visual'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.08</length>
          <radius>0.1</radius>
        </cylinder>
      </geometry>
      <material>
        <ambient>1 0 0</ambient>
        <diffuse>1 0 0</diffuse>
        <specular>0.1 0.1 0.1 1</specular>
      </material>
    </visual>
  </link>

  <joint name='front_right_steer_joint' type='revolute'>
    <pose relative_to='base_link'>0.2 -0.2 0.12 0 0 0</pose>
    <parent>base_link</parent>
    <child>front_right_steer_link</child>
    <axis>
      <xyz>0 0 1</xyz>
      <limit>
        <lower>-3.14159</lower>
        <upper>3.14159</upper>
        <effort>10</effort>
        <velocity>5</velocity>
      </limit>
      <dynamics>
        <damping>0.0001</damping>
      </dynamics>
    </axis>
  </joint>
  <link name='front_right_steer_link'>
    <pose relative_to='front_right_steer_joint'>0 0 0 0 0 0</pose>
    <inertial>
      <pose>0 0 0 0 0 0</pose>
      <mass>1</mass>
      <inertia>
        <ixx>0.000658333</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>0.000658333</iyy>
        <iyz>0</iyz>
        <izz>0.00125</izz>
      </inertia>
    </inertial>
    <collision name='collision'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.02</length>
          <radius>0.05</radius>
        </cylinder>
      </geometry>
    </collision>
    <visual name='visual'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.02</length>
          <radius>0.05</radius>
        </cylinder>
      </geometry>
      <material>
        <ambient>0 0 1</ambient>
        <diffuse>0 0 1</diffuse>
        <specular>0.1 0.1 0.1 1</specular>
      </material>
    </visual>
  </link>

  <joint name='front_right_wheel_joint' type='revolute'>
    <pose relative_to='front_right_steer_link'>0 0 -0.12 -1.5708 0 0</pose>
    <parent>front_right_steer_link</parent>
    <child>front_right_wheel_link</child>
    <axis>
      <xyz>0 0 1</xyz>
      <limit>
        <lower>-1e+16</lower>
        <upper>1e+16</upper>
      </limit>
      <dynamics>
        <damping>0.0001</damping>
      </dynamics>
    </axis>
  </joint>
  <link name='front_right_wheel_link'>
    <pose relative_to='front_right_wheel_joint'>0 0 0 0 0 0</pose>
    <inertial>
      <pose>0 0 0 0 0 0</pose>
      <mass>1</mass>
      <inertia>
        <ixx>0.00303333</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>0.00303333</iyy>
        <iyz>0</iyz>
        <izz>0.005</izz>
      </inertia>
    </inertial>
    <collision name='collision'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.08</length>
          <radius>0.1</radius>
        </cylinder>
      </geometry>
    </collision>
    <visual name='visual'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.08</length>
          <radius>0.1</radius>
        </cylinder>
      </geometry>
      <material>
        <ambient>1 0 0</ambient>
        <diffuse>1 0 0</diffuse>
        <specular>0.1 0.1 0.1 1</specular>
      </material>
    </visual>
  </link>

  <joint name='rear_left_wheel_joint' type='revolute'>
    <pose relative_to='base_link'>-0.2 0.2 0 -1.5708 0 0</pose>
    <parent>base_link</parent>
    <child>rear_left_wheel_link</child>
    <axis>
      <xyz>0 0 1</xyz>
      <limit>
        <lower>-1e+16</lower>
        <upper>1e+16</upper>
      </limit>
      <dynamics>
        <damping>0.0001</damping>
      </dynamics>
    </axis>
  </joint>
  <link name='rear_left_wheel_link'>
    <pose relative_to='rear_left_wheel_joint'>0 0 0 0 0 0</pose>
    <inertial>
      <pose>0 0 0 0 0 0</pose>
      <mass>1</mass>
      <inertia>
        <ixx>0.00303333</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>0.00303333</iyy>
        <iyz>0</iyz>
        <izz>0.005</izz>
      </inertia>
    </inertial>
    <collision name='collision'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.08</length>
          <radius>0.1</radius>
        </cylinder>
      </geometry>
    </collision>
    <visual name='visual'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.08</length>
          <radius>0.1</radius>
        </cylinder>
      </geometry>
      <material>
          <ambient>1 0 0</ambient>
          <diffuse>1 0 0</diffuse>
          <specular>0.1 0.1 0.1 1</specular>
      </material>
    </visual>
  </link>

  <joint name='rear_right_wheel_joint' type='revolute'>
    <pose relative_to='base_link'>-0.2 -0.2 0 -1.5708 0 0</pose>
    <parent>base_link</parent>
    <child>rear_right_wheel_link</child>
    <axis>
      <xyz>0 0 1</xyz>
      <limit>
        <lower>-1e+16</lower>
        <upper>1e+16</upper>
      </limit>
      <dynamics>
        <damping>0.0001</damping>
      </dynamics>
    </axis>
  </joint>
  <link name='rear_right_wheel_link'>
    <pose relative_to='rear_right_wheel_joint'>0 0 0 0 0 0</pose>
    <inertial>
      <pose>0 0 0 0 0 0</pose>
      <mass>1</mass>
      <inertia>
        <ixx>0.00303333</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>0.00303333</iyy>
        <iyz>0</iyz>
        <izz>0.005</izz>
      </inertia>
    </inertial>
    <collision name='collision'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.08</length>
          <radius>0.1</radius>
        </cylinder>
      </geometry>
    </collision>
    <visual name='visual'>
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <cylinder>
          <length>0.08</length>
          <radius>0.1</radius>
        </cylinder>
      </geometry>
      <material>
          <ambient>1 0 0</ambient>
          <diffuse>1 0 0</diffuse>
          <specular>0.1 0.1 0.1 1</specular>
      </material>
    </visual>
  </link>

  <!-- Sensors -->
  <link name='imu_link'>
    <inertial>
      <mass>0.01</mass>
      <inertia>
        <ixx>1.66667E-07</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>1.66667E-07</iyy>
        <iyz>0</iyz>
        <izz>1.66667E-07</izz>
      </inertia>
    </inertial>
    <sensor name="imu_sensor" type="imu">
      <pose>0 0 0 3.141593 0 0</pose>
      <always_on>1</always_on>
      <update_rate>1000.0</update_rate>
    </sensor>
  </link>
  <joint name='imu_joint' type='revolute'>
    <child>imu_link</child>
    <parent>base_link</parent>
    <axis>
      <xyz>0 0 1</xyz>
      <limit>
        <lower>0</lower>
        <upper>0</upper>
      </limit>
      <dynamics>
        <damping>0.0001</damping>
      </dynamics>
      <use_parent_model_frame>1</use_parent_model_frame>
    </axis>
  </joint>

  <!-- Plugins -->
  <plugin name="ignition::gazebo::systems::JointStatePublisher"
      filename="libignition-gazebo-joint-state-publisher-system.so">
  </plugin>
  <plugin name="ignition::gazebo::systems::ApplyJointForce"
      filename="libignition-gazebo-apply-joint-force-system.so">
      <joint_name>rear_left_wheel_joint</joint_name>
  </plugin>
  <plugin name="ignition::gazebo::systems::ApplyJointForce"
      filename="libignition-gazebo-apply-joint-force-system.so">
      <joint_name>rear_right_wheel_joint</joint_name>
  </plugin>
  <plugin name="ignition::gazebo::systems::ApplyJointForce"
      filename="libignition-gazebo-apply-joint-force-system.so">
      <joint_name>front_left_steer_joint</joint_name>
  </plugin>
  <plugin name="ignition::gazebo::systems::ApplyJointForce"
      filename="libignition-gazebo-apply-joint-force-system.so">
      <joint_name>front_right_steer_joint</joint_name>
  </plugin>

  <plugin name="ArduPilotPlugin"
      filename="libArduPilotPlugin.so">
    <!-- Port settings -->
    <fdm_addr>127.0.0.1</fdm_addr>
    <fdm_port_in>9002</fdm_port_in>
    <connectionTimeoutMaxCount>5</connectionTimeoutMaxCount>
    <modelXYZToAirplaneXForwardZDown>0 0 0 3.141593 0 0</modelXYZToAirplaneXForwardZDown>
    <gazeboXYZToNED>0 0 0 3.141593 0 0</gazeboXYZToNED>

    <!-- Sensors -->
    <imuName>imu_link::imu_sensor</imuName>

    <!-- Control / channels -->

    <!--
        SERVO1_FUNCTION 94 (Script 1)
    -->
    <control channel="0">
      <jointName>rear_left_wheel_joint</jointName>
      <useForce>1</useForce>
      <multiplier>100.0</multiplier>
      <offset>-0.5</offset>
      <servo_min>1000</servo_min>
      <servo_max>2000</servo_max>
      <type>VELOCITY</type>
      <p_gain>1</p_gain>
      <i_gain>0</i_gain>
      <d_gain>0</d_gain>
      <i_max>1</i_max>
      <i_min>0</i_min>
      <cmd_max>50.0</cmd_max>
      <cmd_min>-50.0</cmd_min>
    </control>

    <!--
        SERVO2_FUNCTION 95 (Script 2)
    -->
    <control channel="1">
      <jointName>rear_right_wheel_joint</jointName>
      <useForce>1</useForce>
      <multiplier>100.0</multiplier>
      <offset>-0.5</offset>
      <servo_min>1000</servo_min>
      <servo_max>2000</servo_max>
      <type>VELOCITY</type>
      <p_gain>1</p_gain>
      <i_gain>0</i_gain>
      <d_gain>0</d_gain>
      <i_max>1</i_max>
      <i_min>0</i_min>
      <cmd_max>50.0</cmd_max>
      <cmd_min>-50.0</cmd_min>
    </control>

    <!--
        SERVO3_FUNCTION 96 (Script 3)
    -->
    <control channel="2">
      <jointName>front_left_steer_joint</jointName>
      <useForce>1</useForce>
      <multiplier>1.570796327</multiplier>
      <offset>-0.5</offset>
      <servo_min>1000</servo_min>
      <servo_max>2000</servo_max>
      <type>POSITION</type>
      <p_gain>2.0</p_gain>
      <i_gain>0</i_gain>
      <d_gain>0.1</d_gain>
      <i_max>1</i_max>
      <i_min>0</i_min>
      <cmd_max>2.0</cmd_max>
      <cmd_min>-2.0</cmd_min>
    </control>

    <!--
        SERVO4_FUNCTION 97 (Script 4)
    -->
    <control channel="3">
      <jointName>front_right_steer_joint</jointName>
      <useForce>1</useForce>
      <multiplier>1.570796327</multiplier>
      <offset>-0.5</offset>
      <servo_min>1000</servo_min>
      <servo_max>2000</servo_max>
      <type>POSITION</type>
      <p_gain>2.0</p_gain>
      <i_gain>0</i_gain>
      <d_gain>0.1</d_gain>
      <i_max>1</i_max>
      <i_min>0</i_min>
      <cmd_max>2.0</cmd_max>
      <cmd_min>-2.0</cmd_min>
    </control>
  </plugin>

</model>
</sdf>
